---
title:  | 
     ![](logo_DataIntelligence_normal.png){width=4in} \
     Revision a la data descargada del PJ y su unificación según su data
author:
- name: Equipo DS DI
  affiliation: DataIntelligence
subtitle: | 
  <span style="color:green"> Corte de Apelaciones de Antofagasta </span> 
  
header-includes:
   - \usepackage[]{babel}
output:
  rmdformats::html_clean:
    highlight: kate
    toc: true
    use_bookdown: true
    code_folding: "hide"    
    
# bibliography: references.bib 
---

<!-- http://openaccess.uoc.edu/webapps/o2/bitstream/10609/64085/6/romancalafatiTFG0617memoria.pdf -->

`r format(Sys.time(), "%d-%m-%Y")`
<style type="text/css">
.main-container {
  max-width: 1600px;
  margin-left: 100px;
  margin-right: auto;
}
</style>

```{r , message=FALSE, warning=FALSE, include = FALSE, echo = FALSE}
# suppressWarnings(library(RODBC))
library(ggplot2)
library(ggpubr)
library(markdown)
library(shiny)
library(shinythemes)
library(tidyverse)
library(magrittr)
library(lubridate)
library(plotly)
library(xts)
library(dygraphs)
library(kableExtra)
library(knitr)
library("readxl")
library(rsconnect)
library(dplyr)
library(summarytools)
library(epiDisplay)
#library(leaflet)
library(haven)
library(epiDisplay)
library("readxl")
library(expss)
library(hrbrthemes)
library(viridis)
library(viridisLite)
library(DescTools)
library(roperators)
library(shinycssloaders)
library(writexl)
library(labelled)
library(tidyverse)
library(haven)
library(readr)
library(sjmisc)
library(WriteXLS)
library(ineq)
library(readstata13)
library(reldist)
library(DT)
library(rio)
```

<br>

# R

## Leemos los nombres de los excels (8056 tablas)

```{r}
archivos <- tibble(dir("Corte de Apelaciones de Antofagasta/", pattern = ".xlsx"))
names(archivos)[1] <- "value"
archivos
```

## Combinaciones de cabeceras

Transformamos cada nombre leído, correspondiente a un excel a un dataframe y extraemos todas las combinaciones existentes de las cabeceras:

```{r}
limite <- nrow(archivos)
output <- vector("list", length = limite)


for (i in 1:limite ) {
      tryCatch( {
  direccion <- paste0("Corte de Apelaciones de Antofagasta/",archivos$value[i])
  cargado <- import(direccion) 
  
  ###-------------
  
    columnas <- ""
    for (j in 1:ncol(cargado)) {
    columnas <- paste(columnas,colnames(cargado)[j],sep = "-")
    }
  
  output[[i]] <- columnas
      }, error = function(msg){ 
        print(direccion)})
  
}
combinaciones <- unique(as_tibble(unlist(output)))
combinaciones
```

## Unimos por cada una de las 10 combinaciones generadas:

```{r, warning=FALSE, error=FALSE, message=FALSE}
for (m in 1:nrow(combinaciones)) {
  assign(paste0("tabla_",m),"")     # se crean variables bacías
}
for (i in archivos$value[1:nrow(archivos)]) { # recorre todos los archivos
# for (i in archivos$value[1:100]) { # recorre todos los archivos
        tryCatch(
      {
  direccion <- paste0("Corte de Apelaciones de Antofagasta/",i)
  cargado <- read_xlsx(direccion)  
  
    columnas <- ""
    for (j in 1:ncol(cargado)) { 
    columnas <- paste(columnas,colnames(cargado)[j],sep = "-") # extrae combinaciones 
    } 
    
    if(columnas == combinaciones[1,1]){ tabla_1 <- rbind(tabla_1,cargado)}
    if(columnas == combinaciones[2,1]){ tabla_2 <- rbind(tabla_2,cargado)}
    if(columnas == combinaciones[3,1]){ tabla_3 <- rbind(tabla_3,cargado)}
    if(columnas == combinaciones[4,1]){ tabla_4 <- rbind(tabla_4,cargado)}
    if(columnas == combinaciones[5,1]){ tabla_5 <- rbind(tabla_5,cargado)}
    if(columnas == combinaciones[6,1]){ tabla_6 <- rbind(tabla_6,cargado)}
    if(columnas == combinaciones[7,1]){ tabla_7 <- rbind(tabla_7,cargado)}
    if(columnas == combinaciones[8,1]){ tabla_8 <- rbind(tabla_8,cargado)}
    if(columnas == combinaciones[9,1]){ tabla_9 <- rbind(tabla_9,cargado)} 
    if(columnas == combinaciones[10,1]){ tabla_10 <- rbind(tabla_10,cargado)} 
      }, error = function(msg){
        print(direccion)})
}

```



## Generamos los xlsx 


```{r}
write_xlsx(tabla_1,"union_tablas_Antofagasta/tabla_1.xlsx")
write_xlsx(tabla_2,"union_tablas_Antofagasta/tabla_2.xlsx")
write_xlsx(tabla_3,"union_tablas_Antofagasta/tabla_3.xlsx")
write_xlsx(tabla_4,"union_tablas_Antofagasta/tabla_4.xlsx")
write_xlsx(tabla_5,"union_tablas_Antofagasta/tabla_5.xlsx")
write_xlsx(tabla_6,"union_tablas_Antofagasta/tabla_6.xlsx")
write_xlsx(tabla_7,"union_tablas_Antofagasta/tabla_7.xlsx")
write_xlsx(tabla_8,"union_tablas_Antofagasta/tabla_8.xlsx")
write_xlsx(tabla_9,"union_tablas_Antofagasta/tabla_9.xlsx") 
write_xlsx(tabla_10,"union_tablas_Antofagasta/tabla_10.xlsx") 
```

## MAS a la tabla 6

## Hacemos un MAS generando 10 numeros aleatorios entre  

el seed lo hacemos variar entre 1 y 1000

```{r}
set.seed(136)
aleatorios <- sample(1:nrow(tabla_6), 10, replace=TRUE)
receptaculo <- data.frame()

for(i in aleatorios){
   resultado <- tabla_6[i,]
   receptaculo <- rbind(receptaculo,resultado)
}
receptaculo
```

## MAS a la tabla 7

## Hacemos un MAS generando 10 numeros aleatorios entre  

el seed lo hacemos variar entre 1 y 1000

```{r}
set.seed(876)
aleatorios <- sample(1:nrow(tabla_7), 10, replace=TRUE)

receptaculo <- data.frame()

for(i in sort(aleatorios)){
   resultado <- tabla_7[i,]
   receptaculo <- rbind(receptaculo,resultado)
}
receptaculo
```

## MAS a la tabla 8

## Hacemos un MAS generando 10 numeros aleatorios entre  

el seed lo hacemos variar entre 1 y 1000

```{r}
set.seed(234)
aleatorios <- sample(1:nrow(tabla_8), 10, replace=TRUE)

receptaculo <- data.frame()

for(i in sort(aleatorios)){
   resultado <- tabla_8[i,]
   receptaculo <- rbind(receptaculo,resultado)
}
receptaculo
```
 
## MAS a la tabla 9

## Hacemos un MAS generando 10 numeros aleatorios entre  

el seed lo hacemos variar entre 1 y 1000

```{r}
set.seed(546)
aleatorios <- sample(1:nrow(tabla_9), 10, replace=TRUE)

receptaculo <- data.frame()

for(i in sort(aleatorios)){
   resultado <- tabla_9[i,]
   receptaculo <- rbind(receptaculo,resultado)
}
receptaculo
```

## MAS a la tabla 10

## Hacemos un MAS generando 10 numeros aleatorios entre  

el seed lo hacemos variar entre 1 y 1000

```{r}
set.seed(289)
aleatorios <- sample(1:nrow(tabla_10), 10, replace=TRUE)

receptaculo <- data.frame()

for(i in sort(aleatorios)){
   resultado <- tabla_10[i,]
   receptaculo <- rbind(receptaculo,resultado)
}
receptaculo
```

 







































